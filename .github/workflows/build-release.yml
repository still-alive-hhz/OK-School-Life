name: Build and Release EXE

on:
  push:
    tags:
      - 'v*'

permissions:
  contents: write

jobs:
  build-exe:
    # ... ä¿æŒåŸæœ‰ build-exe job ä¸å˜ ...

  create-release:
    name: Create Release
    needs: build-exe
    runs-on: ubuntu-latest
    steps:
      # ... ä¿æŒåŸæœ‰ checkout å’Œ artifact æ­¥éª¤ä¸å˜ ...

      - name: Extract contributors
        id: contributors
        run: |
          current_tag="${{ github.ref_name }}"
          previous_tag=$(git describe --tags --abbrev=0 "$current_tag^" 2>/dev/null || echo "")
          
          if [ -z "$previous_tag" ]; then
            contributors=$(git log --pretty="%an")
          else
            contributors=$(git log --pretty="%an" "$previous_tag".."$current_tag")
          fi

          unique_contributors=$(echo "$contributors" | sort | uniq)
          contributors_list=$(echo "$unique_contributors" | awk '{ printf "- @%s\n", $0 }' | sed 's/ /\\ /g')

          delimiter=$(openssl rand -hex 16)
          echo "contributors<<${delimiter}" >> $GITHUB_OUTPUT
          echo "$contributors_list" >> $GITHUB_OUTPUT
          echo "${delimiter}" >> $GITHUB_OUTPUT

      # ... ä¿æŒåŸæœ‰ changelog å’Œ timestamp æ­¥éª¤ä¸å˜ ...

      - name: Publish release
        uses: softprops/action-gh-release@v1
        with:
          tag_name: ${{ github.ref_name }}
          name: "ğŸ‰ Release ${{ github.ref_name }}"
          body: |
            ## ğŸš€ ç‰ˆæœ¬æ›´æ–°è¯´æ˜
            
            ### ğŸ‘¥ è´¡çŒ®è€…è‡´è°¢
            ${{ steps.contributors.outputs.contributors || 'æš‚æ— è´¡çŒ®è€…ä¿¡æ¯' }}

            ### ğŸ“¦ æ›´æ–°å†…å®¹
            ${{ steps.changelog.outputs.changelog }}
            
            ### ğŸ”§ æ„å»ºä¿¡æ¯
            - ${{ steps.timestamp.outputs.time }}
            - ğŸ“¦ åŒ…å«æ¶æ„: x86 & x64
            - ğŸ·ï¸ ç‰ˆæœ¬æ ‡ç­¾: ${{ github.ref_name }}
            - ğŸ”— è§¦å‘æäº¤: [${{ github.sha }}](https://github.com/${{ github.repository }}/commit/${{ github.sha }})

            ### ğŸ“¥ ä¸‹è½½ç»Ÿè®¡
            æ–‡ä»¶ä¸‹è½½ç»Ÿè®¡ï¼ˆæ¯å°æ—¶è‡ªåŠ¨æ›´æ–°ï¼‰ï¼š
            ```bash
            # ä½¿ç”¨ GitHub API è·å–ä¸‹è½½é‡
            curl -s https://api.github.com/repos/${{ github.repository }}/releases/tags/${{ github.ref_name }} | jq '.assets[] | "\(.name): \(.download_count)"'
            ```

            ### ğŸ“¦ ä¾èµ–å…³ç³»
            æŸ¥çœ‹ä¾èµ–é¡¹ç›®: [![Dependents](https://img.shields.io/badge/ä¾èµ–é¡¹ç›®-ç‚¹å‡»æŸ¥çœ‹-blue)](https://github.com/${{ github.repository }}/network/dependents)
          files: |
            release-files/ok_school_life-windows-x64-*.exe
            release-files/ok_school_life-windows-x86-*.exe